%macro aboriginalIdentity(out=aboriginalIdentity, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id sdcdvabt &demographics); select(sdcdvabt); when(1) aboriginalIdentity = 0; when(2) aboriginalIdentity = 1; otherwise aboriginalIdentity = .; end; run;%mend aboriginalIdentity;
%macro adultBMI(out=adultBMI, cchs_data=, demographics=, excBreastfeeding=true);%local out cchs_data demographics excBreastfeeding;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id hwtdvisw mex_110 &demographics); select(hwtdvisw); when(1) adultBMI = 1; when(2) adultBMI = 2; when(3,4,5,6) adultBMI = 3; otherwise adultBMI = .; end;	%if %upcase(&excBreastfeeding) = TRUE %then %do;	if mex_110 = 1 then do; adultBMI = .; exclude = 1;	end;%end;%else %if %upcase(&excBreastfeeding) = FALSE %then %do; %put ========================================; %put population exclusion was not applied; %put ========================================;%end;%else %do; %put ========================================; %put The following error occured:; %put Valid options for excBreastfeeding are TRUE or FALSE.; %put Please review and try again.; %put ========================================; %abort;%end; run;%mend adultBMI;
%macro anxietyDisorder(out=anxietyDisorder, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ccc_200 &demographics); select(ccc_200); when(1) anxietyDisorder = 1; when(2) anxietyDisorder = 0; otherwise anxietyDisorder = .; end; run;%mend anxietyDisorder;
%macro asthma( out=hasAsthma, cchs_data=, demographics=,);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ccc_015 &demographics); select(ccc_015); when(1) hasAsthma = 1; when(2) hasAsthma = 0; otherwise hasAsthma = .; end;  run;%mend asthma;
%macro cannabisWeekly(out=cannabisWeekly, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id drg_015 &demographics); select(drg_015); when(3,4,5) canWeekly = 1; when(1,2,6) canWeekly = 0; otherwise canWeekly = .; end; run;%mend cannabisWeekly;
%macro consultedMentalHealth(out=consultedMentalHealth, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id cmh_005 &demographics); select(cmh_005); when(1) consultedMentalHealth = 1; when(1,2,6) consultedMentalHealth = 0; otherwise consultedMentalHealth = .; end; run;%mend consultedMentalHealth;
%macro depressionScale(out=depressionScale, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id depdvsev &demographics); select(depdvsev); when(0,1) depression = 0; when(2,3,4,5) depression = 1; otherwise depression = .; end; run;%mend depressionScale;
%macro diabetes(out=diabetes, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ccc_095 &demographics); select(ccc_095); when(1) diabetes = 1; when(2) diabetes = 0; otherwise diabetes = .; end; run;%mend diabetes;
%macro foodSecurity(out=foodSecurity, cchs_data=, demographics=);%local out cchs_data demographics;  %validate( data=&cchs_data, include=&demographics ) data &out(drop=FSC_: DHHDVOKD DHHDVYKD FSCT: DHHTDKS PMKPROXY DOFSC); set &cchs_data.( keep=ont_id dhh_age DOFSC PMKPROXY DHHDVOKD DHHDVYKD FSC_: &demographics );  if (DHHDVOKD+DHHDVYKD=0 and FSC_010 in (3,7,8,9) and FSC_015 in (3,7,8,9) and FSC_020 in (3,7,8,9) and (FSC_010 ne 3 or FSC_015 ne 3 or FSC_020 ne 3))then do; FSC_040 = 9; FSC_045 = 9; FSC_050 = 9; FSC_055 = 9; FSC_060 = 9; FSC_065 = 9; FSC_070 = 9; end; if (DHHDVOKD+DHHDVYKD>0 and FSC_010 in (3,7,8,9) and FSC_015 in (3,7,8,9) and FSC_020 in (3,7,8,9) and FSC_025 in (3,7,8,9) and FSC_030 in (3,7,8,9) and (FSC_010 ne 3 or FSC_015 ne 3 or FSC_020 ne 3 or FSC_025 ne 3 or FSC_030 ne 3)) then do; FSC_035 = 9; FSC_040 = 9; FSC_045 = 9; FSC_050 = 9; FSC_055 = 9; FSC_060 = 9; FSC_065 = 9; FSC_070 = 9; FSC_075 = 9; FSC_080 = 9; FSC_085 = 9; FSC_090 = 9; FSC_095 = 9; end; if (FSC_035 in (3,6) and (FSC_040=2 and FSC_050=2 and FSC_055=2 and fsc_060=2)) then FSC_065=6; if (FSC_035 in (3,6) and (FSC_040=2 and FSC_050=2 and FSC_055=2 and fsc_060=2)) then FSC_070=6;  if DHHDVYKD ^= 0 or DHHDVOKD ^= 0 then DHHTDKS = 1; if DHHDVYKD = 0 and DHHDVOKD = 0 then DHHTDKS = 0; if FSC_010 = 3 and DOFSC = 1 then FSCT010 = 0; if FSC_010 in(1,2) and DOFSC = 1 then FSCT010 = 1; if FSC_015 = 3 and DOFSC = 1 then FSCT015 = 0; if FSC_015 in(1,2) and DOFSC = 1 then FSCT015 = 1; if FSC_020 = 3 and DOFSC = 1 then FSCT020 = 0; if FSC_020 in(1,2) and DOFSC = 1 then FSCT020 = 1; if FSC_025 in(3,6) and DOFSC = 1 then FSCT025 = 0; if FSC_025 in(1,2) and DOFSC = 1 then FSCT025 = 1; if FSC_030 in(3,6) and DOFSC = 1 then FSCT030 = 0; if FSC_030 in(1,2) and DOFSC = 1 then FSCT030 = 1; if FSC_035 in(3,6) and DOFSC = 1 then FSCT035 = 0; if FSC_035 in(1,2) and DOFSC = 1 then FSCT035 = 1; if FSC_040 in(2,6) and DOFSC = 1 then FSCT040 = 0; if FSC_040 = 1 and DOFSC = 1 then FSCT040 = 1; if FSC_045 in(3,6) and DOFSC = 1 then FSCT045 = 0; if FSC_045 in(1,2) and DOFSC = 1 then FSCT045 = 1; if FSC_050 in(2,6) and DOFSC = 1 then FSCT050 = 0; if FSC_050 = 1 and DOFSC = 1 then FSCT050 = 1; if FSC_055 in(2,6) and DOFSC = 1 then FSCT055 = 0; if FSC_055 = 1 and DOFSC = 1 then FSCT055 = 1; if FSC_060 in(2,6) and DOFSC = 1 then FSCT060 = 0; if FSC_060 = 1 and DOFSC = 1 then FSCT060 = 1; if FSC_065 in(2,6) and DOFSC = 1 then FSCT065 = 0; if FSC_065 = 1 and DOFSC = 1 then FSCT065 = 1; if FSC_070 in(3,6) and DOFSC = 1 then FSCT070 = 0; if FSC_070 in(1,2) and DOFSC = 1 then FSCT070 = 1; if FSC_075 in(2,6) and DOFSC = 1 then FSCT075 = 0; if FSC_075 = 1 and DOFSC = 1 then FSCT075 = 1; if FSC_080 in(2,6) and DOFSC = 1 then FSCT080 = 0; if FSC_080 = 1 and DOFSC = 1 then FSCT080 = 1; if FSC_085 in(3,6) and DOFSC = 1 then FSCT085 = 0; if FSC_085 in(1,2) and DOFSC = 1 then FSCT085 = 1; if FSC_090 in(2,6) and DOFSC = 1 then FSCT090 = 0; if FSC_090 = 1 and DOFSC = 1 then FSCT090 = 1; if FSC_095 in(2,6) and DOFSC = 1 then FSCT095 = 0; if FSC_095 = 1 and DOFSC = 1 then FSCT095 = 1; FSCTASUM = sum(FSCT010, FSCT015, FSCT020, FSCT040, FSCT045, FSCT050, FSCT055, FSCT060, FSCT065, FSCT070); FSCTCSUM = sum(FSCT025, FSCT030, FSCT035, FSCT075, FSCT080, FSCT085, FSCT090, FSCT095);  if DOFSC = 2 then FSCDVAFS = 6; else if FSC_010 in(7, 8, 9) or FSC_015 in(7, 8, 9) or FSC_020 in(7, 8, 9) or FSC_040 in(7, 8, 9) or FSC_045 in(7, 8, 9) or FSC_050 in(7, 8, 9) or FSC_055 in(7, 8, 9) or FSC_060 in(7, 8, 9) or FSC_065 in(7, 8, 9) or FSC_070 in(7, 8, 9) or PMKPROXY = 2 then FSCDVAFS = 9; else if 0 <= FSCTASUM <= 1 then FSCDVAFS = 0; else if 2 <= FSCTASUM <= 5 then FSCDVAFS = 1; else if 6 <= FSCTASUM <= 10 then FSCDVAFS = 2; if DOFSC = 2 then FSCDVCFS = 6; else if DHHTDKS = 0 then FSCDVCFS = 6; else if FSC_025 in(7, 8, 9) or FSC_030 in(7, 8, 9) or FSC_035 in(7, 8, 9) or FSC_075 in(7, 8, 9) or FSC_080 in(7, 8, 9) or FSC_085 in(7, 8, 9) or FSC_090 in(7, 8, 9) or FSC_095 in(7, 8, 9) or PMKPROXY = 2 then FSCDVCFS = 9; else if DHHTDKS = 1 and (0 <= FSCTCSUM <= 1) then FSCDVCFS = 0; else if DHHTDKS = 1 and (2 <= FSCTCSUM <= 4) then FSCDVCFS = 1; else if DHHTDKS = 1 and (5 <= FSCTCSUM <= 8) then FSCDVCFS = 2; if DOFSC = 2 then FSCDVHFS = 6; else if FSC_010 in(7, 8, 9) or FSC_015 in(7, 8, 9) or FSC_020 in(7, 8, 9) or FSC_040 in(7, 8, 9) or FSC_045 in(7, 8, 9) or FSC_050 in(7, 8, 9) or FSC_055 in(7, 8, 9) or FSC_060 in(7, 8, 9) or FSC_065 in(7, 8, 9) or FSC_070 in(7, 8, 9) or FSC_025 in(7, 8, 9) or FSC_030 in(7, 8, 9) or FSC_035 in(7, 8, 9) or FSC_075 in(7, 8, 9) or FSC_080 in(7, 8, 9) or FSC_085 in(7, 8, 9) or FSC_090 in(7, 8, 9) or FSC_095 in(7, 8, 9) or PMKPROXY = 2 then FSCDVHFS = 9; else if DHHTDKS = 1 and (0 <= FSCTASUM <= 1) and (0 <= FSCTCSUM <= 1) or DHHTDKS = 0 and (0 <= FSCTASUM <= 1) then FSCDVHFS = 0; else if (DHHTDKS = 1 and (FSCTASUM >= 2 and FSCTASUM <= 5) and (FSCTCSUM >= 2 and FSCTCSUM <= 4)) or (DHHTDKS = 1 and (((FSCTASUM >= 2 and FSCTASUM <= 5) and (FSCTCSUM <= 4)) or ((FSCTASUM <= 5) and (FSCTCSUM >= 2 and FSCTCSUM <= 4)))) or (DHHTDKS = 0 and (FSCTASUM >= 2 and FSCTASUM <= 5)) then FSCDVHFS = 1; else if (DHHTDKS = 1 and ((FSCTASUM >= 6 and FSCTASUM <= 10) or (FSCTCSUM >= 5 and FSCTCSUM <= 8))) or (DHHTDKS = 0 and (FSCTASUM >= 6 and FSCTASUM <= 10)) then FSCDVHFS = 2; select( FSCDVAFS ); when( 0 ) foodInsecureAdult = 0; when( 1, 2 ) foodInsecureAdult = 1; otherwise foodInsecureAdult = .; end; select( FSCDVCFS ); when( 0 ) foodInsecureChild = 0; when( 1, 2 ) foodInsecureChild = 1; otherwise foodInsecureChild = .; end; select( FSCDVHFS ); when( 0 ) foodInsecureHome = 0; when( 1, 2 ) foodInsecureHome = 1; otherwise foodInsecureHome = .; end; if FSCDVHFS = 0 and (fsc_010 in( 1, 2 ) or fsc_015 in( 1, 2 ) or fsc_020 in( 1, 2 ) or fsc_025 in( 1, 2 ) or fsc_030 in( 1, 2 ) or fsc_035 in( 1, 2 ) or fsc_040 = 1 or fsc_045 in( 1, 2 ) or fsc_050 = 1 or fsc_055 = 1 or fsc_060 = 1 or fsc_065 = 1 or fsc_070 in( 1, 2) or fsc_075 = 1 or fsc_080 = 1 or fsc_085 in( 1, 2) or fsc_090 = 1 or fsc_095 = 1) then fs3group = 3; else if FSCDVHFS in( 0, 1, 2 ) then fs3group = FSCDVHFS; else fs3group = .; select( fs3group ); when( 0 ) foodInsecureHome2 = 0; when( 1, 2, 3 ) foodInsecureHome2 = 1; otherwise foodInsecureHome2 = .; end; run;%mend foodSecurity;
%macro fruitVegFive(out=fruitVegFive, cchs_data=, demographics=);%local out cchs_data demographics;  %validate( data=&cchs_data, include=&demographics ) data &out; set &cchs_data.( keep=ont_id dhh_age FVCDVGDT &demographics ); select( FVCDVGDT ); when( 1 ) fruitVegFive = 0; when( 2, 3 ) fruitVegFive = 1; otherwise fruitVegFive = .; end; run;%mend fruitVegFive;
%macro generalHealth(out=generalHealth, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id GENDVHDI dhh_age &demographics); select(GENDVHDI); when(3,4) generalHealth = 1; when(0,1,2) generalHealth = 0; otherwise generalHealth = .; end;run;%mend generalHealth;
%macro heartDisease( out=hasHeartDisease, cchs_data=, demographics=,);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ccc_085 &demographics); select(ccc_085); when(1) hasHeartDisease = 1; when(2) hasHeartDisease = 0; otherwise hasHeartDisease = .; end;  run;%mend heartDisease;
%macro heavyDrinking(out=heavyDrinking, cchs_data=, demographics=, adultsOnly=true);%local out cchs_data demographics adultsOnly;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id alc_020 dhh_age &demographics); select(alc_020); when(3,4,5,6) heavyDrinking = 1; when(1,2,96) heavyDrinking = 0; otherwise heavyDrinking = .; end; %if %upcase(&adultsOnly) = TRUE %then %do; if dhh_age < 19 then do; heavyDrinking = .; exclude = 1; end;%end;%else %if %upcase(&adultsOnly) = FALSE %then %do; %put ======================================; %put Population exclusion was not applied; %put ======================================;%end;%else %do; %put ======================================; %put The following error occurred:; %put Valid options for adultsOnly are TRUE or FALSE.; %put Please review and try again.; %put The macro will stop execution.; %put ======================================; %abort;%end;run;%mend heavyDrinking;
%macro heyFeverNasalAllergy( out=hasNasalAllergy, cchs_data=, demographics=,);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ccc_180 &demographics); select(ccc_180); when(1) hasNasalAllergy = 1; when(2) hasNasalAllergy = 0; otherwise hasNasalAllergy = .; end;  run;%mend heyFeverNasalAllergy;
%macro highBloodPressure(out=highBloodPressure, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ccc_065 &demographics); select(ccc_065); when(1) highBloodPressure = 1; when(2) highBloodPressure = 0; otherwise highBloodPressure = .; end; run;%mend highBloodPressure;
%macro immigrantStatus(out=immigrantStatus, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id sdcdvimm &demographics); select(sdcdvimm); when(1) immigrantStatus = 1; when(2) immigrantStatus = 0; otherwise immigrantStatus = .; end; run;%mend immigrantStatus;
%macro lowRiskDrinking(out=lowRiskDrinking, cchs_data=, demographics=, adultsOnly=true);%local out cchs_data demographics adultsOnly;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id doalw alc_005 alc_010 alw: dhh_age dhh_sex &demographics);  if DOALW = 2 then ALWDVLTR = 6; else if ALC_005 = 2 then ALWDVLTR = 6; else if ALC_005 IN (7, 8, 9) or ALC_010 IN (7, 8, 9) or ALW_005 IN (7, 8, 9) or ALW_010 IN (997, 998, 999) or ALW_015 IN (997, 998, 999) or ALW_020 IN (997, 998, 999) or ALW_025 IN (997, 998, 999) or ALW_030 IN (997, 998, 999) or ALW_035 IN (997, 998, 999) or ALW_040 IN (997, 998, 999) then ALWDVLTR = 9; else if (DHH_SEX = 1 and (ALW_010 in (4:995) or ALW_015 in (4:995) or ALW_020 in (4:995) or ALW_025 in (4:995) or ALW_030 in (4:995) or ALW_035 in (4:995) or ALW_040 in (4:995) or ALWDVWKY in (16:995))) OR (DHH_SEX = 2 and (ALW_010 in (3:995) or ALW_015 in (3:995) or ALW_020 in (3:995) or ALW_025 in (3:995) or ALW_030 in (3:995) or ALW_035 in (3:995) or ALW_040 in (3:995) or ALWDVWKY in (11:995))) then ALWDVLTR = 1; else if (ALW_005 = 2 or ALC_010 = 2 or (DHH_SEX = 1 and ALW_010 =< 3 and ALW_015 =< 3 and ALW_020 =< 3 and ALW_025 =< 3 and ALW_030 =< 3 and ALW_035 =< 3 and ALW_040 =< 3 and ALWDVWKY <= 15)) OR (DHH_SEX = 2 and ALW_010 =< 2 and ALW_015 =< 2 and ALW_020 =< 2 and ALW_025 =< 2 and ALW_030 =< 2 and ALW_035 =< 2 and ALW_040 =< 2 and ALWDVWKY <= 10) then ALWDVLTR = 2; select(alwdvltr); when(1) lowRiskDrinking = 0; when(2,6) lowRiskDrinking = 1; when(9) lowRiskDrinking = .; end; %if %upcase(&adultsOnly) = TRUE %then %do; if dhh_age < 19 then do; lowRiskDrinking = .; exclude = 1; end;%end;%else %if %upcase(&adultsOnly) = FALSE %then %do; %put ======================================; %put Population exclusion was not applied; %put ======================================;%end;%else %do; %put ======================================; %put The following error occurred:; %put Valid options for adultsOnly are TRUE or FALSE.; %put Please review and try again.; %put The macro will stop execution.; %put ======================================; %abort;%end;run;%mend lowRiskDrinking;
%macro mergeBootWt(out=,analysis_data=,boot_data=);  %local rc ds hasExclude bs_msg wt_msg analysis_data boot_data out; %let ds = %sysfunc(open(&analysis_data)); %let hasExclude = %sysfunc(varnum(&ds,EXCLUDE)); %let rc = %sysfunc(close(&ds)); %if &hasExclude ne 0 %then %do; %let bs_msg = A population exclusion was applied to the sample weight.; %let wgt_msg = Use the variable excwgt in all PROC steps related to this population.; %end; %else %do; %let bs_msg = No population exclusions were applied.; %let wgt_msg = Use the variable fwgt in all PROC steps. No addtional weight variables were created.; %end;  proc sort data=&analysis_data; by ont_id; run; proc sort data=&boot_data; by ont_id; run;  data &out; merge &analysis_data &boot_data; by ont_id; %if &hasExclude %then %do; if exclude then excwgt = .; else excwgt = fwgt; %end; run; %put ===============================; %put &bs_msg; %put &wgt_msg; %put ===============================;%mend mergeBootWt;
%macro moodDisorder(out=moodDisorder, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ccc_195 &demographics); select(ccc_195); when(1) moodDisorder = 1; when(2) moodDisorder = 0; otherwise moodDisorder = .; end; run;%mend moodDisorder;
%macro perceivedMentalHealth(out=perceivedMentalHealth, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id gen_015 &demographics); select(gen_015); when(1,2) perceivedMentalHealth = 1; when(3,4,5) perceivedMentalHealth = 0; otherwise perceivedMentalHealth = .; end; run;%mend perceivedMentalHealth;
%macro satisfiedLife(out=satisfiedLife, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id GENDVSWL &demographics); select(GENDVSWL); when(1,2) satisfiedLife = 1; when(3,4,5) satisfiedLife = 0; otherwise satisfiedLife = .; end; run;%mend satisfiedLife;
%macro secondHandSmoke(out=secondHandSmoke, cchs_data=, demographics=, nonSmokersOnly=TRUE);%local out cchs_data demographics nonSmokersOnly;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id adm_prx smk_005 mac_005--mac_015 ets_005 ets_030--ets_040 &demographics);  if mac_005 not in(1,2) and mac_010 ne 1 then ets_030 = 6; if mac_005 ne 4 and mac_015 ne 1 then ets_030 = 6; if adm_prx = 1 and smk_005 = 1 then do; ets_030 = 6; ets_035 = 6; ets_040 = 6; end;  select(ets_030); when(1) etsWorkSchool = 1; when(2,6) etsWorkSchool = 0; otherwise etsWorkSchool = .; end; select(ets_035); when(1) etsPublic = 1; when(2,6) etsPublic = 0; otherwise etsPublic = .; end; select(ets_040); when(1) etsVehicle = 1; when(2,6) etsVehicle = 0; otherwise etsVehicle = .; end; if etsWorkSchool = 1 or etsVehicle = 1 or etsPublic = 1 then etsAny = 1; else if etsWorkSchool = . and etsVehicle = . and etsPublic = . then etsAny = .; else etsAny = 0; %if %upcase(&nonSmokersOnly) = TRUE %then %do; if smk_005 = 1 then do; etsWorkSchool = .; etsVehicle = .; etsPublic = .; etsAny = .; exclude = 1; end;%end;%else %if %upcase(&nonSmokersOnly) = FALSE %then %do; %put ======================================; %put Population exclusion was not applied; %put ======================================;%end;%else %do; %put ======================================; %put The following error occurred:; %put Valid options for nonSmokersOnly are TRUE or FALSE.; %put Please review and try again.; %put The macro will stop execution.; %put ======================================; %abort;%end;run;%mend secondHandSmoke;
%macro senseBelonging(out=senseBelonging, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id gen_030 &demographics); select(gen_030); when(1,2) senseBelonging = 1; when(3,4) senseBelonging = 0; otherwise senseBelonging = .; end; run;%mend senseBelonging;
%macro sexualOrientation(out=sexualOrientation, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id sdc_035 &demographics); select(sdc_035); when(1) sexualOrientation = 0; when(2) sexualOrientation = 1; when(3) sexualOrientation = 2; otherwise sexualOrientation = .; end; run;%mend sexualOrientation;
%macro sleepSevenHours(out=sleepSevenHours, cchs_data=, demographics=, adultsOnly=true);%local out cchs_data demographics;  %validate( data=&cchs_data, include=&demographics ) data &out; set &cchs_data.( keep=ont_id dhh_age slp_005 &demographics ); select( slp_005 ); when( 1, 2, 3, 4, 5, 6 ) sleepSevenHours = 0; when( 7, 8, 9, 10, 11, 12 ) sleepSevenHours = 1; otherwise sleepSevenHours = .; end; %if %upcase(&adultsOnly) = TRUE %then %do; if dhh_age < 18 then do; sleepSevenHours = .; exclude = 1; end;%end;%else %if %upcase(&adultsOnly) = FALSE %then %do; %put ======================================; %put Population exclusion was not applied; %put ======================================;%end;%else %do; %put ======================================; %put The following error occurred:; %put Valid options for adultsOnly are TRUE or FALSE.; %put Please review and try again.; %put The macro will stop execution.; %put ======================================; %abort;%end; run;%mend sleepSevenHours;
%macro sunburn(out=sunburn, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ssb_005 &demographics); select(ssb_005); when(1) sunburn = 1; when(2) sunburn = 0; otherwise sunburn = .; end; run;%mend sunburn;
%macro sunProtection(out=sunProtection, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id ssbdvprt &demographics); select(ssbdvprt); when(1) sunProtection = 1; when(2) sunProtection = 0; otherwise sunProtection = .; end; run;%mend sunProtection;
%macro underageDrinking(out=underageDrinking, cchs_data=, demographics=);%local out cchs_data demographics;  %validate(data=&cchs_data,include=&demographics) data &out; set &cchs_data.(keep=ont_id alc_010 dhh_age &demographics); select(alc_010); when(1) underage = 1; when(2,6) underage = 0; otherwise underage = .; end; if dhh_age >= 19 then do; underage = .; exclude = 1; end; run;%mend underageDrinking;
%macro validate(data=,include=);%local data include;%if %length(&data)=0 %then %do; %let _varflag=E; %let _varmsg= A dataset name is required for parameter OUT!; %goto err_exit;%end;%else %do; %let _dsid=%sysfunc(exist(&data,data));  %if &_dsid=0 %then %do; %let _varflag=E; %let _varmsg= The dataset &data does not exist!; %goto err_exit; %end;%end;%if %length(&include) ne 0 %then %do; %let _dsid=%sysfunc(open(&data));  %local count this_var; %let count=1; %let this_var = %qscan(&include,&count,%str( )); %do %while(&this_var ne); %let _varnum=%sysfunc(varnum(&_dsid,&this_var)); %if &_varnum=0 %then %do;  %let _varflag=E; %let _varmsg= The variable &this_var does not exits in the dataset &data.!; %goto err_exit; %end; %let count = %eval(&count+1); %let this_var = %qscan(&demographics,&count,%str( )); %end;%end;%goto clean_exit;%err_exit:  %put ====================================================; %put The following error occurred while running the macro:; %put &_varmsg; %put; %put Please review input and try again.; %put; %put The macro will stop execution.; %put ====================================================;  %abort;%clean_exit: %put ====================================================; %put No invalid parameters were detected.; %put The macro will continue dummy coding.; %put ====================================================;%mend validate;